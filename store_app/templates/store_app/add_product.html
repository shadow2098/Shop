{% extends 'store_app/main.html' %}
{% load static %}
{% block content %}

<div class="row">
    <div class="col-lg-6">
        <form id="product-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" name="name" placeholder="Enter name" required>
            </div>
            <div class="form-group">
                <label for="price">Price:</label>
                <input type="number" class="form-control" id="price" name="price" placeholder="Enter price" required>
            </div>
            <div class="form-group">
                <label for="digital">Digital:</label>
                <input type="checkbox" id="digital" name="digital">
            </div>
            <div class="form-group">
                <label for="image">Image:</label>
                <input type="file" class="form-control-file" id="image" name="image" accept="image/jpeg,image/jpg,image/png" required>
                <small id="imageHelp" class="form-text text-muted">Accepted file types: JPEG, JPG, PNG</small>
            </div>
            <input id="form-button" class="log-in-btn btn-success btn-block" type="submit" value="Continue" style="margin-left: 2px;">
        </form>
    </div>
</div>

{% endblock content %}

<script>
    var form = document.getElementById('product-form');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        submit_form_data();
        console.log('Form is submitted');
    });

    function submit_form_data() {
        var formData = new FormData(form);

        var url_name = 'http://127.0.0.1:8000/add_product_process/';

        fetch(url_name, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}' // Using Django template tag to get CSRF token
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Network response was not ok.');
            }
        })
        .then(data => {
            console.log('Response from server:', data);
            alert('Product added successfully');
            window.location.href = "http://127.0.0.1:8000/"; // Redirect to home page
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>
